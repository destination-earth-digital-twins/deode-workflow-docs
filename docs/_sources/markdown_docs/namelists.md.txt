# Namelist handling in deode
Describes the namelist handling in the Deode-Prototype.

## Internal usage
The deode namelists are stored as yml files and assembled following a set of rules. The upper air and surfex namelists are stored in `master_namelists.yml` and `surfex_namelists.yml` respectively. In these config files the namelists are grouped depending on function and application. E.g. the namelist for generation of climate files (configuration E923) are separated in a base block, `e923_base` and one additional block for each step, e.g. `e923_0`. In `assemble_master.yml` the rules for how these blocks are combinged is defined. For the initial part, `e923_part_0` is defined as

```
e923_part_0:
  - common_e923
  - e923_0
```
where `common_e923` is another group in the assemble rules and `e923_0` is a group in the namelist file. This will be expanded to the three namelist groups
```
  - empty
  - e923_base
  - e923_0
```

In addition the defined macros (see `marcos.toml`) are use in the namelist for config driven selections. For e.g. the forecast the settings are dependent on the CSC used as well as the forcing model and the config keys `general.csc` and `boundaries.bdmodel` are used accordingly like:
```
forecast:
  - master_common
  - f4_@CSC@
  - namgfl_@BDMODEL@
```
where e.g. `@BDMODEL@` is substituted runtime to e.g. `AROME` or `IFS` which allows to pick of the corresponding section in `master_namelists.yml`.

## Get a specific namelist from command line
For a given configuration file any namelist generated by the system can be extracted from command line using e.g. for the forecast
```
deode show namelist -t master -n forecast
```
If you are uncertain about the name of the namelist you're searching for just type any name to get a list
```
deode show namelist -t master -n showme 
```
If you'd like have the namelist without the substituted values from the config file add a `-b` to the command. For more information about namelist extraction use the help command.
```
deode show namelist -h
```

## Add your own namelist

The simplest and recommended way to change a namelist is to extract it as described above using the `-b` option, make your modifications and add the namelist to the directory specified by `system.namelists` in the config file. The name of the namelist should be the same as when extracted above. Before the system will pick up your namelist you have to set `general.accept_stat_namelist = true` in the config file. Note that for the main forecast namelist any existing fullpos select files following the name convention "xxt\*" will be picked up as well if they exists. If not they will be generated.

```
